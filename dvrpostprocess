#!/bin/bash

source "/opt/galaxymediatools/functions/prechecknl"

LOGF="/video/Incoming/logs/dvrpostporcess.log"

echo " " >> $LOGF
echo "---------- STARTING RECORDED TV POST PROCESS ----------" >> $LOGF
echo "Checking transcode server state..." >> $LOGF
fping -c1 -t300 $T1IP 2>/dev/null 1>/dev/null
if [ $? -ne 0 ]; then
   echo "Attempting to wake server $T1NAME..." >> $LOGF
  wakeonlan $T1MAC 2>/dev/null 1>/dev/null
  wakeonlan $T1MAC 2>/dev/null 1>/dev/null
  sleep 15
  fping -c1 -t300 $T1IP 2>/dev/null 1>/dev/null
if [ $? -ne 0 ]; then
  echo "$T1NAME failed wake and server is not responding." >> $LOGF
  exit 1
fi
else

ssh $T1INFO /opt/galaxymediatools/dvrprocess/PlexComskip.py "$1" &

echo "Executing remote PlexComskip script" >> $LOGF

wait
echo " " >> $LOGF
echo "---------- COMPLETED RECORDED TV POST PROCESS ----------" >> $LOGF
fi

